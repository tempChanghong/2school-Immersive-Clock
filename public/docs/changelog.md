# 📝 更新日志

## 🚀 v3.13.1

### 🛠️ Bug 修复
- 修复了报告弹窗中三图切换按钮的移动端显示问题。
- 修复了无麦克风权限时未及时弹窗的问题。
- 修复了调试功能的持久化保存问题。

### 🔧 优化
- 优化了部分天气api的调用逻辑。

---
## 🚀 v3.13.0

### ✨ 新增

- 自习报告新增历史记录功能，点击状态灯可以查看历史记录。
- 自习报告新增了各种图表的直观展示。
- 自习报告图表添加了各种动画效果，更加生动。
- 天气预警弹窗现在支持通过颜色区分不同预警等级。
- 设置中支持自定义应用启动时所打开的页面(时钟、倒计时、秒表、自习)。
- 现在首次使用时会提供新手引导，帮助用户快速上手。
- 设置中的关于页新增错误与调试功能，用户可以在设置中开启。
- 添加了天气预警、分钟级降水、空气污染、日出日落、明日预报弹窗提醒功能。

### 🛠️ Bug 修复

- 修复了在某些情况下，状态栏进度条消失的问题。
- 修复了各种UI元素的交互问题，提升了用户体验。
- 修复了在某些情况下，噪音显示为负数的问题。
- 修复了消息弹窗的动画卡顿问题。
- 修复了各种已知问题。

### 🔧 优化

- 更新了项目构建工具为Vite 5
- 优化了设置界面的布局与交互。
- 优化了项目的代码与性能。
- 优化了分钟级降水预报弹窗的逻辑与展示内容。
- 优化了设置页的实时天气显示。
- 现在错误信息会通过消息弹窗展示，而不是在组件上显示。

### ♻️ 重构

- 重构了噪音监测组件的采集、存储、评分、帧处理、切片聚合。
- 重构了自习噪音报告组件的展示与交互。
- 重构了消息弹窗的逻辑与展示内容。

---

## 🚀 v3.12.0 ~ v3.12.6

### ✨ 新增

- 课程表新增了支持Excel导入功能。
- 天气组件支持获取空气质量指数、以及三日天气预测。
- 天气设置页支持设置天气数据刷新时间间隔与手动获取地理位置。
- 弹窗公告新增了意见反馈按钮，用户可以直接在弹窗中反馈问题。
- 自习页面支持自定义中央时间与日期的颜色。
- 桌面端支持 NTP 作为网络校时来源。
- 设置中新增了GPS手动刷新按钮。
- 支持了自定义本地语录抽取模式（随机/顺序）。
- 新增了当噪音等级超过阈值时，自动播放提示音效的功能。
- 支持了自定义导入导出设置项的功能。

### 🛠️ Bug 修复

- 修复了公告弹窗七天不再显示功能失效的问题。
- 修复了自定义时段名称显示问题。
- 移除了第一次启动时麦克风自动校准的逻辑。
- 修复了设置界面切换时tab栏抽搐问题。
- 修复了Electron无法获取系统GPS权限的问题。
- 修复了设置中RMS校准失效的问题。

### 🔧 优化

- 优化了时间模块的准确性。
- 优化了部分UI与功能的交互体验。
- 优化了噪音阈值后的提示音效。
- 移除和风天气GeoAPI的调用。
- 优化了设置界面部分的UI。
- 优化了噪音数据的持久化性能。
- 优化了数据读写效率。

### ♻️ 重构

- 重构了天气组件，提高了代码的可维护性。
- 重构了本地存储机制。

---

## 🚀 v3.11.0 ~ v3.11.10

### ✨ 新增

- 支持自定义字体。
- 设置中新增了刷新地理位置按钮。
- 自定义字体支持导入系统已安装字体。
- 新增了对 Electron 应用的支持。
- 新增了消息弹窗天气预报功能（beta）。
- 新增更多统计指标。
- 新增了消息通知功能(beta)，用户可以在设置中开启/关闭消息通知。
- 新增了对金内置句的缓存及编辑功能。
- 新增了用户自行编辑或者导入txt作为语录源的功能。
- 在关于页新增了一个按钮用于清除缓存。
- 新增了设置项热更新功能，用户可以在设置中实时调整参数，无需刷新页面。
- 设置中支持自定义噪音计算时间窗。
- 设置中支持自定义自习页面各个组件的显示与隐藏。
- 设置中支持倒计时事件轮播。
- 设置中支持自定义倒计时事件的数字颜色与透明度。
- 设置中支持自定义倒计时事件的显示顺序。

### 🛠️ Bug 修复

- 修复了部分自定义字体无法导入或导入后不生效的问题。
- 修复了自定义字体设置UI异常问题。
- 修复了天气预警重复显示的问题。
- 修复了自定义语录源中，用户上传txt文件后，设置界面无法正常显示的问题。
- 修复了统计报告中噪音等级显示异常的问题。
- 修复了统计报告样式异常问题。
- 修复了移动端tab栏显示异常的问题。
- 修复了语录组件显示异常的问题。

### 🔧 优化

- 优化了设置界面的部分布局，提升了用户体验。
- 重构了自习模式自定义字体存储机制，以支持更大的字体文件并提升加载稳定性。
- 优化了天气弹窗的显示效果与逻辑。
- 移除了删除滚动波动（差分均值）图。
- 优化了部分UI的细节。
- 优化了代码结构，提高了性能。
- 优化了天气组件相关API的请求逻辑。
- 优化了高考倒计时的显示效果。

### ♻️ 重构

- 重构了噪音监测模块，优化了性能和实时图表显示与数据处理。
- 优化了设置面板的布局与交互，用户可以更方便地自定义设置。

---

## 🚀 v3.10.0 ~ v3.10.8

### ✨ 新增

- 自习页面新增背景设置：用户可以在自习页面自定义背景颜色或图片。
- 设置面板新增“关于”页：展示版本、许可证、作者网站与开源地址。
- 噪音分贝值显示：在噪音监测状态中显示当前环境噪音分贝值。
- 噪音监测设置：新增在设置中开启/关闭噪音监测功能的选项。
- 支持自定义噪音监测阈值：用户可以在设置中自定义噪音监测的阈值，根据个人环境调整。
- 倒计时音效完善：最后 5 秒逐秒提示音效，结束播放终止音。

### 🛠️ Bug 修复

- 移动端噪音状态文本容器背景异常：移除黑色背景，样式与桌面端保持一致。
- 修复了倒计时和秒表计时不准确的问题。

### 🔧 优化

- 优化字体加载速度与缓存策略：首屏加载更快且离线可用。
- 改进噪音计算与判定方式：优化基线估计、移动平均与阈值判定，提醒更稳定、误报更少。
- 优化噪音实时图表显示。
- 优化在线字体缓存机制：为 Google Fonts 样式与字体配置更合理的缓存策略，首屏加载更快且离线可用。
- 倒计时显示颜色一致性：移除可点击态默认透明度，数字常态显示为白色，与其它界面保持一致。
- 模式文案统一：将“计时”更名为“秒表”。
- 提升版本缓存策略：关键静态资源携带版本参数，更新后强制刷新。
- 代码结构与可靠性优化：更清晰的状态管理边界与副作用控制。
- 设置面板支持“点击保存后才生效”的统一机制。

### ♻️ 重构

- 重新设计设置面板与公告栏的 Tabs 布局：统一公告风格、支持粘性顶栏与横向滚动，交互更清晰。
- 重构噪音计算机制，噪音计算更精准。

---

## 🚀 v3.5.2 ~ v3.9.0 (早期版本回顾)

### ✨ 新增

- 新增噪音报告功能：在课时结束前自动生成统计报告，支持历史查看与关键指标展示。
- 支持多种倒计时事件功能。
- 支持 PWA 离线功能：启用 Service Worker 自动更新，导航回退覆盖所有同源路径。
- 在设置中新增语录刷新间隔的自定义选项。

### 🔧 优化

- 优化噪音组件交互与可视化：独立滚动的历史记录左右栏、图表阈值线与面积填充、语义化无障碍属性。
- 设置面板新增“自动弹出报告”开关，支持持久化偏好。
- 优化地理位置获取策略：优先使用浏览器原生 Geolocation，支持高德 IP 定位回退。
- 全面优化设置界面及全局表单组件，交互与一致性显著提升。
- 显著提升网站 SEO 性能：语义化结构优化、元信息完善、站点地图与资源加载策略改进。
- 优化缓存策略：更新 PWA 导航回退、清理重复服务器头等。
- 精简在线语录分类：仅保留「文学、诗词、哲学、抖机灵」。

### 🛠️ Bug 修复

- 修复设置界面开关按钮方向绘制错误。

### ♻️ 重构

- 重构天气获取组件，采用和风天气作为主要天气信息来源。

---

_每一次更新都是为了给您带来更好的使用体验。感谢您的支持，如有建议欢迎反馈！_
